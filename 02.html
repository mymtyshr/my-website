<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>è¼¸æ¶²è£½å‰¤ã®ä½“å†…åˆ†å¸ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM CDN (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel (JSXã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§å¤‰æ›ã™ã‚‹ãŸã‚) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      const FluidDistributionApp = () => {
        const [selectedFluid, setSelectedFluid] = useState('saline');
        const [infusionVolume, setInfusionVolume] = useState(0);

        // åˆæœŸå€¤ï¼ˆ70kgæˆäººã®æ¨™æº–å€¤ã€mLå˜ä½ï¼‰
        const initialICF = 28000;        // ç´°èƒå†…æ¶² 28L
        const initialInterstitial = 10500; // é–“è³ªæ¶² 10.5L
        const initialPlasma = 3500;       // è¡€æ¼¿ 3.5L

        const fluidTypes = {
          saline: {
            name: 'ç”Ÿé£Ÿ/ãƒªãƒ³ã‚²ãƒ«',
            fullName: 'ç”Ÿç†é£Ÿå¡©æ°´ãƒ»ä¹³é…¸ãƒªãƒ³ã‚²ãƒ«æ¶²',
            color: '#06b6d4',
            description: 'ç´°èƒå¤–æ¶²ã¨åŒã˜æµ¸é€åœ§ã€‚å…¨é‡ãŒç´°èƒå¤–æ¶²ã«åˆ†å¸ƒ',
            icfRatio: 0,
            interstitialRatio: 0.75,
            plasmaRatio: 0.25
          },
          solution1: {
            name: '1å·æ¶²',
            fullName: 'é–‹å§‹æ¶²ï¼ˆ1å·æ¶²ï¼‰',
            color: '#14b8a6',
            description: 'è¡“å¾ŒåˆæœŸã®ç¶­æŒæ¶²ã€‚ç´°èƒå¤–æ¶²ã¨ç´°èƒå†…æ¶²ã«åˆ†å¸ƒ',
            icfRatio: 0.33,
            interstitialRatio: 0.5,
            plasmaRatio: 0.17
          },
          solution3: {
            name: '3å·æ¶²',
            fullName: 'ç¶­æŒæ¶²ï¼ˆ3å·æ¶²ï¼‰',
            color: '#10b981',
            description: 'ç¶­æŒè¼¸æ¶²ã®åŸºæœ¬ã€‚å…¨èº«ã®ä½“æ¶²ã«åˆ†å¸ƒ',
            icfRatio: 0.5,
            interstitialRatio: 0.375,
            plasmaRatio: 0.125
          },
          glucose: {
            name: 'ãƒ–ãƒ‰ã‚¦ç³–æ¶²',
            fullName: '5%ãƒ–ãƒ‰ã‚¦ç³–æ¶²',
            color: '#22c55e',
            description: 'ä½“å†…ã§ä»£è¬ã•ã‚Œè‡ªç”±æ°´ã¨ã—ã¦åˆ†å¸ƒã€‚å…¨èº«ã®ä½“æ¶²ã«åˆ†å¸ƒ',
            icfRatio: 0.67,
            interstitialRatio: 0.2475,
            plasmaRatio: 0.0825
          },
          colloid: {
            name: 'è† è³ªæ¶²',
            fullName: 'è† è³ªæ¶²ï¼ˆã‚¢ãƒ«ãƒ–ãƒŸãƒ³ã€HESç­‰ï¼‰',
            color: '#f59e0b',
            description: 'è¡€ç®¡å†…ã«ç•™ã¾ã‚Šã‚„ã™ã„ã€‚ä¸»ã«è¡€æ¼¿å†…ã«åˆ†å¸ƒ',
            icfRatio: 0,
            interstitialRatio: 0.2,
            plasmaRatio: 0.8
          }
        };

        const calculateDistribution = () => {
          const fluid = fluidTypes[selectedFluid];

          return {
            icf: initialICF + infusionVolume * fluid.icfRatio,
            interstitial: initialInterstitial + infusionVolume * fluid.interstitialRatio,
            plasma: initialPlasma + infusionVolume * fluid.plasmaRatio,
            icfChange: infusionVolume * fluid.icfRatio,
            interstitialChange: infusionVolume * fluid.interstitialRatio,
            plasmaChange: infusionVolume * fluid.plasmaRatio
          };
        };

        const data = calculateDistribution();
        const initialTotalVolume = initialICF + initialInterstitial + initialPlasma;
        const totalVolume = data.icf + data.interstitial + data.plasma;

        // ä½“ç©ã«åŸºã¥ã„ã¦å¹…ã‚’è¨ˆç®—
        const maxInfusion = 3000;
        const baseWidth = 900;
        const volumeScale = baseWidth / (initialTotalVolume + maxInfusion); // æœ€å¤§æŠ•ä¸ã¾ã§å…¥ã‚‹ã‚ˆã†ã«èª¿æ•´

        const icfWidth = data.icf * volumeScale;
        const interstitialWidth = data.interstitial * volumeScale;
        const plasmaWidth = data.plasma * volumeScale;

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-6">
            <div className="max-w-7xl mx-auto">
              <div className="bg-white rounded-2xl shadow-xl p-4 md:p-8">
                <h1 className="text-2xl md:text-3xl font-bold text-gray-800 mb-2">
                  è¼¸æ¶²è£½å‰¤ã®ä½“å†…åˆ†å¸ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
                </h1>
                <p className="text-sm md:text-base text-gray-600 mb-6 md:mb-8">
                  è¼¸æ¶²è£½å‰¤ã®ç¨®é¡ã¨æŠ•ä¸é‡ã‚’é¸æŠã™ã‚‹ã¨ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ä½“æ¶²åŒºç”»ã¸ã®åˆ†å¸ƒãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                </p>

                <div className="space-y-6 md:space-y-8">
                  {/* 3Dãƒœãƒƒã‚¯ã‚¹è¡¨ç¤ºï¼ˆ1ã¤ã«çµ±ä¸€ï¼‰ */}
                  <div className="bg-gray-50 rounded-xl p-4 md:p-6">
                    <h2 className="text-lg md:text-xl font-bold text-gray-800 mb-2 text-center">
                      ä½“æ¶²åŒºç”»ã®åˆ†å¸ƒ
                    </h2>
                    <p className="text-xs md:text-sm text-gray-600 mb-4 md:mb-6 text-center">
                      æŠ•ä¸å¾Œ30åˆ†ã€œ1æ™‚é–“çµŒéã—ã€å…¨ä½“ã«è¡Œãæ¸¡ã£ãŸçŠ¶æ…‹ã‚’æƒ³å®š
                    </p>
                    <div className="flex justify-center overflow-x-auto">
                      <svg
                        className="w-full max-w-4xl"
                        viewBox="0 0 900 300"
                        preserveAspectRatio="xMidYMid meet"
                      >
                        <defs>
                          <linearGradient id="icfGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style={{ stopColor: '#22d3ee', stopOpacity: 1 }} />
                            <stop offset="100%" style={{ stopColor: '#06b6d4', stopOpacity: 1 }} />
                          </linearGradient>
                          <linearGradient id="interstitialGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style={{ stopColor: '#06b6d4', stopOpacity: 1 }} />
                            <stop offset="100%" style={{ stopColor: '#0891b2', stopOpacity: 1 }} />
                          </linearGradient>
                          <linearGradient id="plasmaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style={{ stopColor: '#155e75', stopOpacity: 1 }} />
                            <stop offset="100%" style={{ stopColor: '#164e63', stopOpacity: 1 }} />
                          </linearGradient>
                        </defs>

                        {/* æŠ•ä¸æ¶²ã®è¡¨ç¤ºï¼ˆå·¦ä¸Šï¼‰ */}
                        {infusionVolume > 0 && (
                          <g>
                            <rect
                              x="50"
                              y="20"
                              width="200"
                              height="40"
                              fill={fluidTypes[selectedFluid].color}
                              opacity="0.9"
                              stroke="#0e7490"
                              strokeWidth="2"
                              rx="4"
                            />
                            <text
                              x="150"
                              y="40"
                              textAnchor="middle"
                              fill="white"
                              fontSize="14"
                              fontWeight="bold"
                            >
                              {fluidTypes[selectedFluid].name}
                            </text>
                            <text x="150" y="57" textAnchor="middle" fill="white" fontSize="12">
                              {infusionVolume} mL
                            </text>
                          </g>
                        )}

                        {/* 3Dæ¨ªå‘ããƒœãƒƒã‚¯ã‚¹ */}
                        <g transform="translate(50, 100)">
                          {/* ICF - ç´°èƒå†…æ¶²ï¼ˆå·¦å´ï¼‰ */}
                          <g>
                            <rect
                              x="0"
                              y="0"
                              width={icfWidth}
                              height="120"
                              fill="url(#icfGradient)"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />
                            <path
                              d={`M 0 0 L 30 -30 L ${icfWidth + 30} -30 L ${icfWidth} 0 Z`}
                              fill="#22d3ee"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />
                            <path
                              d={`M ${icfWidth} 0 L ${icfWidth + 30} -30 L ${icfWidth + 30} 90 L ${icfWidth} 120 Z`}
                              fill="#06b6d4"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />

                            <text
                              x={icfWidth / 2}
                              y="50"
                              textAnchor="middle"
                              fill="white"
                              fontSize="18"
                              fontWeight="bold"
                            >
                              ç´°èƒå†…
                            </text>
                            <text
                              x={icfWidth / 2}
                              y="70"
                              textAnchor="middle"
                              fill="white"
                              fontSize="14"
                            >
                              {(data.icf / 1000).toFixed(1)} L
                            </text>
                            {infusionVolume > 0 && (
                              <text
                                x={icfWidth / 2}
                                y="88"
                                textAnchor="middle"
                                fill="white"
                                fontSize="12"
                                opacity="0.9"
                              >
                                ({data.icfChange >= 0 ? '+' : ''}
                                {(data.icfChange / 1000).toFixed(2)} L)
                              </text>
                            )}
                          </g>

                          {/* Interstitial - é–“è³ªæ¶²ï¼ˆä¸­å¤®ï¼‰ */}
                          <g>
                            <rect
                              x={icfWidth}
                              y="0"
                              width={interstitialWidth}
                              height="120"
                              fill="url(#interstitialGradient)"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />
                            <path
                              d={`M ${icfWidth} 0 L ${icfWidth + 30} -30 L ${
                                icfWidth + interstitialWidth + 30
                              } -30 L ${icfWidth + interstitialWidth} 0 Z`}
                              fill="#06b6d4"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />
                            <path
                              d={`M ${icfWidth + interstitialWidth} 0 L ${
                                icfWidth + interstitialWidth + 30
                              } -30 L ${icfWidth + interstitialWidth + 30} 90 L ${
                                icfWidth + interstitialWidth
                              } 120 Z`}
                              fill="#0891b2"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />

                            <text
                              x={icfWidth + interstitialWidth / 2}
                              y="50"
                              textAnchor="middle"
                              fill="white"
                              fontSize="16"
                              fontWeight="bold"
                            >
                              é–“è³ª
                            </text>
                            <text
                              x={icfWidth + interstitialWidth / 2}
                              y="70"
                              textAnchor="middle"
                              fill="white"
                              fontSize="13"
                            >
                              {(data.interstitial / 1000).toFixed(1)} L
                            </text>
                            {infusionVolume > 0 && (
                              <text
                                x={icfWidth + interstitialWidth / 2}
                                y="86"
                                textAnchor="middle"
                                fill="white"
                                fontSize="11"
                                opacity="0.9"
                              >
                                (+{(data.interstitialChange / 1000).toFixed(2)} L)
                              </text>
                            )}
                          </g>

                          {/* Plasma - è¡€æ¼¿ï¼ˆå³å´ï¼‰ */}
                          <g>
                            <rect
                              x={icfWidth + interstitialWidth}
                              y="0"
                              width={plasmaWidth}
                              height="120"
                              fill="url(#plasmaGradient)"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />
                            <path
                              d={`M ${icfWidth + interstitialWidth} 0 L ${
                                icfWidth + interstitialWidth + 30
                              } -30 L ${icfWidth + interstitialWidth + plasmaWidth + 30} -30 L ${
                                icfWidth + interstitialWidth + plasmaWidth
                              } 0 Z`}
                              fill="#0891b2"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />
                            <path
                              d={`M ${icfWidth + interstitialWidth + plasmaWidth} 0 L ${
                                icfWidth + interstitialWidth + plasmaWidth + 30
                              } -30 L ${icfWidth + interstitialWidth + plasmaWidth + 30} 90 L ${
                                icfWidth + interstitialWidth + plasmaWidth
                              } 120 Z`}
                              fill="#164e63"
                              stroke="#0e7490"
                              strokeWidth="2"
                            />

                            <text
                              x={icfWidth + interstitialWidth + plasmaWidth / 2}
                              y="50"
                              textAnchor="middle"
                              fill="white"
                              fontSize="14"
                              fontWeight="bold"
                            >
                              è¡€æ¼¿å†…
                            </text>
                            <text
                              x={icfWidth + interstitialWidth + plasmaWidth / 2}
                              y="70"
                              textAnchor="middle"
                              fill="white"
                              fontSize="12"
                            >
                              {(data.plasma / 1000).toFixed(1)} L
                            </text>
                            {infusionVolume > 0 && (
                              <text
                                x={icfWidth + interstitialWidth + plasmaWidth / 2}
                                y="86"
                                textAnchor="middle"
                                fill="white"
                                fontSize="10"
                                opacity="0.9"
                              >
                                (+{(data.plasmaChange / 1000).toFixed(2)} L)
                              </text>
                            )}
                          </g>

                          {/* ãƒ©ãƒ™ãƒ« */}
                          <text
                            x={icfWidth / 2}
                            y="155"
                            textAnchor="middle"
                            fontSize="14"
                            fontWeight="bold"
                            fill="#0e7490"
                          >
                            ICF
                          </text>
                          <text
                            x={icfWidth + (interstitialWidth + plasmaWidth) / 2}
                            y="155"
                            textAnchor="middle"
                            fontSize="14"
                            fontWeight="bold"
                            fill="#0e7490"
                          >
                            ECF
                          </text>
                        </g>
                      </svg>
                    </div>
                  </div>

                  {/* è¨­å®šãƒ‘ãƒãƒ« */}
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                    {/* è¼¸æ¶²è£½å‰¤é¸æŠ */}
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        è¼¸æ¶²è£½å‰¤ã®ç¨®é¡
                      </label>
                      <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2">
                        {Object.entries(fluidTypes).map(([key, fluid]) => (
                          <button
                            type="button"
                            key={key}
                            onClick={() => setSelectedFluid(key)}
                            className={`p-2 md:p-3 rounded-lg cursor-pointer transition-all text-center ${
                              selectedFluid === key
                                ? 'bg-white border-2 border-blue-500 shadow-md'
                                : 'bg-gray-50 border-2 border-gray-200 hover:border-gray-300'
                            }`}
                          >
                            <div className="flex items-center justify-center mb-1">
                              <span
                                className="w-3 h-3 rounded-full"
                                style={{ backgroundColor: fluid.color }}
                              />
                            </div>
                            <span className="font-semibold text-xs md:text-sm text-gray-800 block">
                              {fluid.name}
                            </span>
                          </button>
                        ))}
                      </div>
                      <div className="mt-3 p-3 bg-blue-50 rounded-lg">
                        <p className="text-xs md:text-sm text-gray-700">
                          <span className="font-semibold">
                            {fluidTypes[selectedFluid].fullName}ï¼š
                          </span>
                          {fluidTypes[selectedFluid].description}
                        </p>
                      </div>
                    </div>

                    {/* æŠ•ä¸é‡è¨­å®šã¨æƒ…å ± */}
                    <div>
                      <div className="mb-4">
                        <label className="block text-sm font-semibold text-gray-700 mb-3">
                          æŠ•ä¸é‡: {infusionVolume} mL
                        </label>
                        <input
                          type="range"
                          min="0"
                          max={maxInfusion}
                          step="50"
                          value={infusionVolume}
                          onChange={(e) => setInfusionVolume(Number(e.target.value))}
                          className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                        />
                        <div className="flex justify-between text-xs text-gray-500 mt-2">
                          <span>0 mL</span>
                          <span>{maxInfusion} mL</span>
                        </div>
                      </div>

                      {infusionVolume > 0 ? (
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                          <div className="bg-green-50 rounded-lg p-3">
                            <h3 className="font-semibold text-gray-800 mb-2 text-xs md:text-sm">
                              ç·ä½“æ¶²é‡ã®å¤‰åŒ–
                            </h3>
                            <div className="space-y-1 text-xs text-gray-600">
                              <p>â€¢ æŠ•ä¸å‰: {(initialTotalVolume / 1000).toFixed(1)} L</p>
                              <p>â€¢ æŠ•ä¸å¾Œ: {(totalVolume / 1000).toFixed(2)} L</p>
                              <p className="font-semibold text-green-700">
                                â€¢ å¢—åŠ : +{((totalVolume - initialTotalVolume) / 1000).toFixed(2)} L
                              </p>
                            </div>
                          </div>

                          <div className="bg-blue-50 rounded-lg p-3">
                            <h3 className="font-semibold text-gray-800 mb-2 text-xs md:text-sm">
                              æŠ•ä¸é‡ã®åˆ†å¸ƒ
                            </h3>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between items-center">
                                <span className="text-gray-700">ç´°èƒå†…æ¶²</span>
                                <span
                                  className={`font-semibold ${
                                    data.icfChange >= 0 ? 'text-green-600' : 'text-red-600'
                                  }`}
                                >
                                  {data.icfChange >= 0 ? '+' : ''}
                                  {data.icfChange.toFixed(0)} mL
                                </span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-gray-700">é–“è³ªæ¶²</span>
                                <span className="font-semibold text-green-600">
                                  +{data.interstitialChange.toFixed(0)} mL
                                </span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-gray-700">è¡€æ¼¿</span>
                                <span className="font-semibold text-green-600">
                                  +{data.plasmaChange.toFixed(0)} mL
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      ) : (
                        <div className="bg-gray-100 rounded-lg p-4 flex items-center justify-center">
                          <p className="text-xs md:text-sm text-gray-600 text-center">
                            ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦æŠ•ä¸é‡ã‚’è¨­å®š
                          </p>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* èª¬æ˜ */}
                  <div className="bg-amber-50 border-l-4 border-amber-400 p-4 rounded">
                    <h3 className="font-semibold text-amber-900 mb-2">ğŸ“š åŸºæº–å€¤ï¼ˆ70kgæˆäººï¼‰</h3>
                    <div className="text-sm text-amber-800">
                      <ul className="space-y-1 text-xs">
                        <li>â€¢ ç´°èƒå†…æ¶²ï¼ˆICFï¼‰: 28 Lï¼ˆä½“é‡ã®40%ï¼‰</li>
                        <li>â€¢ é–“è³ªæ¶²: 10.5 Lï¼ˆç´°èƒå¤–æ¶²ã®75%ï¼‰</li>
                        <li>â€¢ è¡€æ¼¿: 3.5 Lï¼ˆç´°èƒå¤–æ¶²ã®25%ï¼‰</li>
                        <li>â€¢ ç·ä½“æ¶²é‡ï¼ˆTBWï¼‰: 42 Lï¼ˆä½“é‡ã®60%ï¼‰</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<FluidDistributionApp />);
    </script>
  </body>
</html>
